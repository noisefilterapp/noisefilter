function handleError(e){console.error(`Error: ${e}`)}const state={currentURL:void 0,currentHostName:void 0,extPaused:void 0,domainPaused:void 0};function handleMessage(e){if("init"===e.re)return coverage.has(state.currentHostName)?Promise.resolve({url:state.currentURL,host:state.currentHostName,ext:state.extPaused,domain:state.domainPaused,inject:!0}):Promise.resolve({url:state.currentURL,host:state.currentHostName,ext:state.extPaused,domain:state.domainPaused,inject:!1});"extPaused"===e.re?setExtPausedStorage(e.extPaused).then(()=>{refreshPage()}):"domainPaused"===e.re&&setDomainPausedStorage(e.domainPaused).then(()=>{refreshPage()})}function setCurrentURL(e){state.currentURL=e}function setHostName(e){state.currentHostName=e}function setDomainPaused(e){state.domainPaused=e}function setExtPaused(e){state.extPaused=e}function setDomainPausedStorage(e){return new Promise((t,a)=>{setDomainPaused(e),browser.storage.local.set({[state.currentHostName]:e}).then(()=>{t()},handleError)})}function setExtPausedStorage(e){return new Promise((t,a)=>{setExtPaused(e),browser.storage.local.set({paused:e}).then(()=>{t()},handleError)})}function getDomainPausedStorage(){return new Promise((e,t)=>{browser.storage.local.get(state.currentHostName).then(t=>{setDomainPaused(t[state.currentHostName]),e()},handleError)})}function getExtPausedStorage(){return new Promise((e,t)=>{browser.storage.local.get("paused").then(t=>{setExtPaused(t.paused),e()},handleError)})}function handleNewURL(e,t,a){extractURL(a.url),getExtPausedStorage(),getDomainPausedStorage()}function extractURL(e){setCurrentURL(e),setHostName(new URL(e).hostname)}function refreshPage(){"about"!==state.currentURL.slice(0,5)&&browser.tabs.reload()}browser.tabs.onUpdated.addListener(handleNewURL),browser.runtime.onMessage.addListener(handleMessage);